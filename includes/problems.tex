\section{Problem Suites}
\label{sec:problems}

    We generated several suites of string and regex problems using \fuzzer{}. \footnote{For review anonymity, we removed the link to the problem repository. It will be provided separately in the artifact submission track and will appear in the final version of the paper.} Below, we describe the \texttt{generated} suite that we generated using \generator{}: \\

    \begin{tabular}{|l|l|}
        \hline
        \textbf{Name}    & \textbf{Problems have ...} \\ \hline
        Concats          & A single, deep tree of concats. \\ \hline
        Concats-Extracts & A single concat tree, and random character extractions. \\ \hline
        Lengths          & A single, large length constraint on a variable. \\ \hline
        Lengths-Concats  & Variables and their concats, each with fixed lengths. \\ \hline
        Overlaps         & A formula in the form A.X = X.B. \\ \hline
        Regex            & A test for regex membership of arbitrary complexity. \\ \hline
        Many-Regexes     & A test for membership in many random regexes. \\ \hline
        Regex-Deep       & A test for membership in a regex with many nested operators. \\ \hline
        Regex-Pair       & A test for membership in one regex, but not another. \\ \hline
        Regex-Lengths    & A test for membership in a regex, and a length constraint. \\ \hline
    \end{tabular}
    \hfill \\

    \todo{Federico: fill in descriptions. First draft - Federico}

    The \texttt{transformed} suite contains benchmarks derived from existing seed problems by iteratively applying \transformer{}.
    Every problem in the suite is named according to its seed and the transformations it undertook. 
    For example, a hypothetical file named ``seed-fuzz-graft.smt2'' began as a file named ``seed.smt'' and was transformed twice:
    first by fuzz, and then by graft. 
    
    The suite is divided into two categories. For an overview see Table~\ref{tbl:transformed}.
    
    \begin{table}
    \begin{tabular}{|l|l|r|}
        \hline
        \textbf{Name} & \textbf{Seed}                            & \textbf{Quantity} \\ \hline
        Amazon        & Two industrial regex membership problems & 516\\ \hline
        Regex         & Z3str2 regular expression test suite     & 10,577\\ \hline
    \end{tabular}
    \caption{\transformer{} generated problem sets.}
    \label{tbl:transformed}
    \end{table}

    The first category, labeled Amazon, started as two seed files.
    The first seed, z3-regex-1.smt2, encodes the assertions ``S not in aaabbb*'' and ``S in aaa*bbb*'' for a string constant S,
    while the second seed, z3-regex-2-negative.smt2, encodes the assertions ``S in aaabbb*'' and ``S not in aaa*bbb*''. 
    Both problems come from our industrial collaborators. 
    In total, 516 unique problems were generated from these two seeds.
    
    The second category, Regex, is seeded by the z3str2 regular expression test suite \cite{z3str2-tests}.
    This test suite contains 42 problems dealing with a wide variety of regular expressions.
    Through cumulative transformations, as before, we were able to produce 10,577 unique benchmarks.


    \subsection{Usefulness to \us{}}

        This section describes the bugs we discovered in \us{} (that were subsequently fixed) by testing it with the \fuzzer{} problem suites.

        The first bug we found caused \us{} to perform poorly when the equivalence class of arithmetic terms is very large (e.g. where many strings are equal to the empty string, and thus have length 0). The slowdown was caused by a loop over the equivalence class of these terms to search for an integer constant. The fix was to check the root of the equivalence class for the integer constant, as Z3 makes "interpreted terms" (i.e. constants) the root of equivalence classes whenever possible. This bug was last observed in commit 6308636, and was fixed in commit 3865c45.

        The second bug we found caused \us{} to perform poorly when a variable had a large length constraint. The slowdown was caused by the solver performing a linear search for a satisfying length when producing a model for the variable. This bug was an inconsistency between the implementation and the behaviour described in the \us{} paper \cite{z3str3}. This bug was last observed in commit 66bc68f, and was fixed in commit 7b536e9.

        \todo{Federico - Can we describe the floating point error we found?}

        \todo{Dmitry: maybe show graphs with before and after?}
